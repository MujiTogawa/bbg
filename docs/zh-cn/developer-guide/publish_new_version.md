
# 如何发布新版本

## 版本号规则简介

BBG 的版本号是从当前日期转化而来的八位整数（例如`20230505`）。

## BBG 如何处理不同版本的博客数据文件

BBG 生成博客的数据文件中记录了上次被打开编辑时使用的是哪一个版本的 BBG。当 BBG 尝试打开一个博客时，会根据以下情况判断执行何种操作：

* 如果博客数据文件中的记录值比程序版本更新，为了避免损坏数据，BBG 会拒绝打开该博客
* 如果程序版本比博客数据文件中的记录值更新，BBG 会提示用户升级博客数据文件，从而使得博客数据文件中的记录值与程序版本相同
* 如果博客数据文件的记录值和程序版本一致，则正常打开该博客

## BBG 如何升级博客数据文件

升级博客数据文件的过程是通过`migrate_core.js`进行的。它会用自带的更新的`index.html`文件覆盖博客中的`index.html`文件（在使用官方主题的情况下），并包含了一系列条件判断代码，首先判断博客数据文件中的记录值具体是哪一个旧版本，并给出对应的升级策略。如果本次更新会变更博客数据文件`index.json`的内容，则你需要手动在`migrate_core.js`中编写代码实现。如果本次更新不会变更`index.json`的内容则不需要修改`migrate_core.js`。

## 如何发布新版本 BBG

首先确保你已经处理好了升级博客数据文件的方案（参考上节）。

然后在`docs/CHANGELOG.md`中编写更新日志。

然后先在 BBG 代码仓库根目录下执行如下命令更新`package.json`和`App.json`中的版本号。

```
yarn run modify_version_number
```

然后执行如下命令：

```
git add .
git commit -m "bump to version <新的版本号>"
git push
git tag -a <新的版本号> -m "bump to version <新的版本号>"
git push origin --tags
```